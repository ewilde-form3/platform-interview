ca_certs:
  trusted:
    - |
      -----BEGIN CERTIFICATE-----
      MIIDUjCCAjqgAwIBAgIJAKGbgmk1v5iwMA0GCSqGSIb3DQEBCwUAMFkxCzAJBgNV
      BAYTAkdCMSMwIQYDVQQKExpCYWNrIE9mZmljZSBUZWNobm9sb2d5IEx0ZDElMCMG
      A1UEAxMccGFsby1hbHRvLnN5c3RlbXMuZm9ybTMudGVjaDAeFw0yMTAyMjMwOTQ4
      MjlaFw0yNDAyMjMwOTQ4MjlaMFkxCzAJBgNVBAYTAkdCMSMwIQYDVQQKExpCYWNr
      IE9mZmljZSBUZWNobm9sb2d5IEx0ZDElMCMGA1UEAxMccGFsby1hbHRvLnN5c3Rl
      bXMuZm9ybTMudGVjaDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAJ0C
      6mwiX2JPtAyIfg8+LNLTBZbB/PsXYcbirUoA31cM/6uZK+9xYHD95WthpHA5yp4s
      SUoP+KQiiAs6UHk8fvKkKDyiZYPzbFzWUAsWZwvplqfHgjOj9sGmzdBNlHI+JD7i
      lfJrRk62veGrsubjoxMgzpvWRw0MO96YNMQA+l0DpT+v6CQPBdtKloXajMUiRBDI
      pCaM2R7HLrCtuQVedP8n8E+X34G9h6tCJtOd4+kMNDdiAK176C9f6a1Qhj4aDkFb
      tYoD5RC0jatqC7u7HhfmZn1jUC/OlQvKXKAmMNr55aycUiKQLGsksJHLcqvmD8XG
      et01szQ0dQ2jW19sdZkCAwEAAaMdMBswDAYDVR0TBAUwAwEB/zALBgNVHQ8EBAMC
      AgQwDQYJKoZIhvcNAQELBQADggEBACL33t6vUJkmLwzbCXtIA0SCxxFKFfr0W7Sd
      D15FPiNypFiF2LzHhLbAuCWHNsoQWeilxnIVZX75KDLBudn/zPXqwGh4O+2j3etN
      AtZbJFnBH0A6bJRnopEfLz0qSanIVPV7YDqeS1Xotc/OK0/+Rkr0iUOmCrorfUAv
      5kx4VSOOrg+tbzwqEp0YMq8aE+sVadFPshh1SfoTUQJ1a6qh7q3Wm0cPPvt0yf7A
      NXFVlMb+Ti/GsqxKarS/wYWFm317wT+GXITXJGmHOyul9cY4Ko6jPg0lRH4Zd2Xj
      sNB68Aax1FbduXZUa+ngGb8QYooEfusLPs05OTTl5ympJEtah3U=
      -----END CERTIFICATE-----
write_files:
  - path: /form3.ca
    content: |
        -----BEGIN CERTIFICATE-----
        MIIDUjCCAjqgAwIBAgIJAKGbgmk1v5iwMA0GCSqGSIb3DQEBCwUAMFkxCzAJBgNV
        BAYTAkdCMSMwIQYDVQQKExpCYWNrIE9mZmljZSBUZWNobm9sb2d5IEx0ZDElMCMG
        A1UEAxMccGFsby1hbHRvLnN5c3RlbXMuZm9ybTMudGVjaDAeFw0yMTAyMjMwOTQ4
        MjlaFw0yNDAyMjMwOTQ4MjlaMFkxCzAJBgNVBAYTAkdCMSMwIQYDVQQKExpCYWNr
        IE9mZmljZSBUZWNobm9sb2d5IEx0ZDElMCMGA1UEAxMccGFsby1hbHRvLnN5c3Rl
        bXMuZm9ybTMudGVjaDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAJ0C
        6mwiX2JPtAyIfg8+LNLTBZbB/PsXYcbirUoA31cM/6uZK+9xYHD95WthpHA5yp4s
        SUoP+KQiiAs6UHk8fvKkKDyiZYPzbFzWUAsWZwvplqfHgjOj9sGmzdBNlHI+JD7i
        lfJrRk62veGrsubjoxMgzpvWRw0MO96YNMQA+l0DpT+v6CQPBdtKloXajMUiRBDI
        pCaM2R7HLrCtuQVedP8n8E+X34G9h6tCJtOd4+kMNDdiAK176C9f6a1Qhj4aDkFb
        tYoD5RC0jatqC7u7HhfmZn1jUC/OlQvKXKAmMNr55aycUiKQLGsksJHLcqvmD8XG
        et01szQ0dQ2jW19sdZkCAwEAAaMdMBswDAYDVR0TBAUwAwEB/zALBgNVHQ8EBAMC
        AgQwDQYJKoZIhvcNAQELBQADggEBACL33t6vUJkmLwzbCXtIA0SCxxFKFfr0W7Sd
        D15FPiNypFiF2LzHhLbAuCWHNsoQWeilxnIVZX75KDLBudn/zPXqwGh4O+2j3etN
        AtZbJFnBH0A6bJRnopEfLz0qSanIVPV7YDqeS1Xotc/OK0/+Rkr0iUOmCrorfUAv
        5kx4VSOOrg+tbzwqEp0YMq8aE+sVadFPshh1SfoTUQJ1a6qh7q3Wm0cPPvt0yf7A
        NXFVlMb+Ti/GsqxKarS/wYWFm317wT+GXITXJGmHOyul9cY4Ko6jPg0lRH4Zd2Xj
        sNB68Aax1FbduXZUa+ngGb8QYooEfusLPs05OTTl5ympJEtah3U=
        -----END CERTIFICATE-----
  - path: ~/install.sh
    permissions: '0755'
    content: |
        #!/usr/bin/env bash
        adduser ubuntu docker
        curl -L "https://github.com/docker/compose/releases/download/v2.6.1/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
        chmod +x /usr/local/bin/docker-compose
        ARCH=$(dpkg --print-architecture)
        echo Installing terraform onto machine...
        mkdir -p $HOME/bin
        sudo apt-get update && sudo apt-get install -y unzip jq
        pushd $HOME/bin
        wget -q https://releases.hashicorp.com/terraform/1.2.5/terraform_1.2.5_linux_${ARCH}.zip
        unzip -q -o terraform_1.2.5_linux_${ARCH}.zip
        popd
        
        echo Install tflocal
        sudo update-alternatives --install /usr/bin/python python /usr/bin/python3 1
        sudo apt install python3-pip -y
        sudo apt install python-pip -y
        pip install localstack-client
        pip install terraform-local
        . ~/.profile
groups:
  - docker
snap:
  commands:
  - [install, docker]
runcmd:
  - ~/install.sh
